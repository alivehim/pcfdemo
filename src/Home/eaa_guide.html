<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Policy & Ref Guide</title>
    <style>
        .pbi-panel {
            background-color: white;
        }

        html,
        body {
            height: 100%;
        }
    </style>
    <link rel="stylesheet" href="./aia_eaa_guide.css">
</head>

<body class="text-gray px-10 py-4 w-full">
    <div class="w-full" style="height: 100%;">
        <div class="flex-1 bg-center bg-cover " style="background-color: #F4F5F5;height: 100%;">
            <div class="flex-1 p-8 md:p-14 lg:p-16 xl:p-20 flex items-center justify-center" style="height: 100%;">
                <div class="grid-cols-1 md:grid-cols-2 gap-5 h-full grid-rows-4 md:grid-rows-2 w-full"
                    style="max-width: 700px;">
                    <div id="Policy"
                        class="flex-col items-center border-light-red border rounded-lg mask-bg p-5 flex cursor-pointer pbi-panel"
                        onclick="openDocument(Files.Policy)">
                        <span class="text-xl font-bold pbi-icon-text textcolor">Policy</span>
                    </div>
                    <br />
                    <div id="ProcessFlowchart"
                        class="flex-col items-center border-light-red border rounded-lg mask-bg p-5 flex cursor-pointer pbi-panel"
                        onclick="openDocument(Files.ProcessFlowChart)">
                        <span class="text-xl font-bold pbi-icon-text textcolor">Process Flowchart</span>
                    </div>
                    <br />
                    <div id="QuickReferenceGuide"
                        class="flex-col items-center border-light-red border rounded-lg mask-bg p-5 flex cursor-pointer pbi-panel"
                        onclick="openDocument(Files.QuickReferenceGuide)">
                        <span class="text-xl font-bold pbi-icon-text textcolor">Quick Reference Guide</span>
                    </div>
                </div>
            </div>

        </div>
    </div>
</body>
<script>

    var Files = {
        Policy: "EAA:Guide:Policy",
        ProcessFlowChart: "EAA:Guide:FlowChart",
        QuickReferenceGuide: "EAA:Guide:QuickReference"
    }

    window.Xrm = window.parent.Xrm

    window.openDocument = async (fileKey) => {
        Xrm.Utility.showProgressIndicator()
        try {
            await fetch(
                `/api/data/v9.0/aia_eaa_configs/?$filter=aia_name eq '${fileKey}'`,
            ).then(res => res.json()).then(res => {

                if (res.error) {
                    throw new Error(res.error.message)
                }

                if (res.value.length === 0) {
                    throw new Error('file 404')
                }

                window.open(res.value[0].aia_eaa_value);

            })
        } catch (err) {
            console.log('get file  error in try catch: ', err)
        }

        Xrm.Utility.closeProgressIndicator()
    }

    window.onload = () => {
    }

</script>

</html>